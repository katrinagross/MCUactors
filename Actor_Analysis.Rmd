---
title: "Analysis"
author: "Katrina Gross"
date: "4/18/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
library(ggplot2)
library(tidyverse)
library(scales)
library(vcd)
```

```{r}
film_clean <- read_csv("5-3-film-clean-for-analysis.csv")


film_clean <- film_clean %>%
  mutate(award_mcu = factor(award_mcu, levels = c("Non-MCU", "MCU", "Academy Award Nominee", "Academy Award Winner")),
         decade = cut(as.numeric(year), breaks = seq(from = 1960, to = 2030, by = 10), 
                        include.lowest = TRUE, right = FALSE, labels = FALSE),
         decade = factor(decade, levels = c(1, 2, 3, 4, 5, 6, 7),
                         labels = c("60's", "70's", "80's", "90's", "00's", "10's", "20's")))
  
```

# build out theme

```{r}

mcu_theme <- function(){
  font <- "Helvetica"
  theme_minimal() +
  theme(title = element_text(family = font, size = 15),
        axis.title = element_text(family = font, size = 12),
        axis.text.x = element_text(family = font, size = 11),
        axis.text.y = element_text(family = font, size = 11)
        )
}

colors <- c("#000000", #"Black"
           "#233f92", #"Dark Cornflower Blue"
           "#44a0e3", # "Carolina Blue"
           "#C4D6FA", # Light Blue
           "#8b6b87", # "Chinese Violet"
           "#d2352b", #"Maximum Red"
           "#e58c31", # "Cadmium Orange"
           "#f7e336", #"Minion Yellow"
           "#fbf19b", # "Green Yellow Crayola"
           "#feffff", # "White"
           "#f1c2ae" # "Apricot"
)

```

# try out some options before d3

```{r}

g1 <- film_clean %>%
  filter(year >= 1990) %>%
  filter(type == "Movie") %>%
  ggplot(aes(x = release_date, y = actor_name, color = MCU, size = World_Wide)) +
  scale_size(range = c(1,4), name = "Box Office") +
  scale_x_date(date_breaks = "5 years", date_labels = "%Y") +
  scale_color_manual(values = c(colors[2], colors[11]))+
  labs(y = "Actor Name",
       x = "Release Date",
       title = "Filmography Box Office")+
  geom_point(aplha = 0.8) +
  theme_minimal()

g1

g2 <- film_clean %>%
  filter(year >= 1990) %>%
  filter(type == "TV Series" | type == "Limited Series") %>%
  ggplot(aes(x = release_date, y = actor_name, color = MCU)) +
  scale_x_date(date_breaks = "5 years", date_labels = "%Y") +
  scale_color_manual(values = c(colors[2], colors[11])) +
  geom_point(alpha = 0.8) +
  theme_minimal()

g2

```

```{r, fig.width=5}

awards_graph <- film_clean %>%
  filter(year >= 1990) %>%
  filter(type == "Movie") %>%
  arrange(award_mcu, descending = FALSE)
  
  
g_awards <- ggplot(awards_graph) +
  geom_point(mapping = aes(x = release_date, y = actor_name, color = award_mcu), 
             size = 1.5,) +
  scale_x_date(date_breaks = "5 years", date_labels = "%Y") +
  scale_color_manual(values = c(colors[4], colors[2], colors[11], colors[6]), name = "Film Type")+
  labs(y="",
       x = "Release Date",
       title = "Film Releases by Actor",
       subtitle = "Any Credited Role")+
  theme_minimal()

g_awards

```


# Decade Heatmap

```{r}

h1 <- film_clean %>%
  filter(type == "Movie") %>%
  group_by(actor_name, decade) %>%
  summarize(movie_count = n(), .groups = 'drop') %>%
  arrange(decade) %>%
  ggplot(aes(x = decade, y = actor_name, fill = movie_count)) +
  geom_tile(color = "grey") +
  #scale_y_discrete(limits=rev) +
  coord_fixed(ratio = 0.5) +
  scale_fill_gradient(low = colors[4], high = colors[2], name = "Movie Count") +
  labs(y = "Actor",
       x = "Decade",
       title = "Movie Count by Decade") +
  theme_minimal() +
  theme(panel.grid = element_blank())
  
h1

```

# barplot box office

```{r}

mcu_box_stack <- film_clean %>%
  filter(MCU_film == 1) %>%
  pivot_longer(cols = c(International, Domestic), names_to = "bo_loc", values_to = "boxoffice") %>%
  select(c(title, bo_loc, boxoffice)) %>% distinct() %>%
  ggplot(aes(x = reorder(title, boxoffice), y = boxoffice, fill = bo_loc)) + 
  geom_bar(position="stack", stat="identity") +
  scale_y_continuous(expand = c(0, 0), labels = label_dollar(suffix = " B", scale = 1e-9)) +
  coord_flip() +
  scale_fill_manual(values = c(colors[11], colors[5]), name = "")+
  labs(title = "Box Office MCU Movies",
       y = "",
       x = "") +
  theme_minimal()

mcu_box_stack

```

# Gender - Award Mosaic Plot

```{r}

gender <- film_clean %>%
  filter(MCU == "Non-MCU", type == "Movie") %>%
  mutate(Awards = ifelse(is.na(winner), "None", winner),
         Awards = ifelse(Awards == "Nominated", "Nom", Awards),
         Awards = ifelse(Awards == "Winner", "Won", Awards)) %>%
  group_by(actor_name, Gender, Awards, `BeforeMCU`) %>%
  summarize(Freq = n(), .groups = 'drop') %>%
  ungroup() %>%
  group_by(Gender, `BeforeMCU`, Awards) %>%
  summarize(Freq = mean(Freq), .groups = 'drop') %>%
  ungroup() %>%
  mutate(Freq = ceiling(Freq),
         BeforeMCU = factor(BeforeMCU)) 

# mosaic plot

mosaic(BeforeMCU ~ Gender + Awards, direction = c("v", "v", "h"), gender, 
       highlighting_fill = c(colors[4], colors[2]),
      rot_labels = c(0, 0, 90, 0))

```

# movie/tv first

```{r}
first_credit <- film_clean  %>%
  filter(!title %in% c("The Simpsons", "The Tonight Show with Jay Leno", 
                       "Late Night with Conan O'Brien", "Sesame Street")) %>%
  group_by(actor_name) %>%
  slice(which.min(release_date))

g_first <- first_credit %>%
  ggplot(aes(x = release_date, y = reorder(actor_name, release_date), color = type)) +
  geom_segment(aes(x = min(release_date), xend = as.Date(release_date), y = reorder(actor_name, release_date), 
                   yend = reorder(actor_name, release_date)), color = "grey") +
  geom_point(size = 3) +
  scale_x_date(date_breaks = "5 years", date_labels = "%Y") +
  scale_color_manual(values = c(colors[6], colors[11]))+
  labs(title = "Most MCU actors got their start in TV",
       subtitle = "First Credited Role",
       y="",
       x = "Release Date")+
  theme_minimal()

g_first
```
# Ratings 

```{r}

hex_ratings <- ggplot(film_clean, aes(x = averageRating, y = World_Wide)) +
  geom_hex() +
  labs(x = "Average Rating",
       y = "Box Office (world-wide)",
       title = "Ratings and Budgets are higher for MCU films") +
  scale_fill_gradient(low = colors[4], high = colors[2], name = "Movie Count") +
  scale_y_continuous(labels = label_dollar(suffix = " B", scale = 1e-9)) +
  facet_wrap(~MCU)+
  mcu_theme()

hex_ratings

```

